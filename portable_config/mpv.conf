## personal configuration ##

## VIDEO ##

profile=gpu-hq #honestly idk if this does anything

######################
## renderer and api ##
######################
vo=gpu-next
gpu-api=d3d11 #d3d11 on par with vulkan and has hdr support
hwdec=no
hwdec-codecs=all

## OpenGL settings ##
#poor performance and no output with hdr input
opengl-glfinish=no
opengl-swapinterval=1 #0 vsync off 1 vsync on
opengl-pbo #may be worse
opengl-dwmflush=auto #no, windowed, yes, auto. may affect framedrop differences between windowed and fullscreen.
opengl-es=yes #auto, yes, no

## Vulkan settings ##
vulkan-async-compute=yes
vulkan-async-transfer=yes
vulkan-queue-count=1
vd-lavc-dr=yes
vulkan-swap-mode=auto #auto, fifo (vsync on), fifo-relaxed (tearing), mailbox (triple buffer), immediate (vsync off)

## D3D11 Settings ##
d3d11-feature-level=12_1 #12_1|12_0|11_1|11_0|10_1|10_0|9_3|9_2|9_1
d3d11-flip=yes
d3d11-exclusive-fs=no
d3d11-sync-interval=1
d3d11-output-format=rgb10_a2
d3d11-output-csp=auto

#####################
## scaling options ##
##################### 
scaler-resizes-only=yes
correct-downscaling=yes
sigmoid-upscaling=yes
linear-downscaling=no #perceptually inconsequential, "yes" may be worse
#linear-upscaling=yes #bad and redundant.
scaler-lut-size=10 #4-10. default 6. 2%-ish performance impact.

## scaling algorithms ##
scale=jinc
scale-window=jinc
scale-radius=3.2383 #0.5-16. 2.3 or 3.2383
scale-blur=0.867 #0.867
scale-antiring=1.0

#####################
## C and D scaling ##
#####################
## chroma scaling algorithms ##
cscale=mitchell #preferrable for krig.
cscale-antiring=1.0

## downscaling algorithms ##
dscale=lanczos
dscale-antiring=1.0
#dscale-radius=0.804
#dscale-blur=0.000

#######################################
## color management and tone mapping ##
#######################################
## basic color ##
target-prim=bt.709
target-trc=auto
target-colorspace-hint #enables HDR. not an "option" so not compatible with auto profiles(?)
target-peak=auto
video-output-levels=full

## tone mapping ##
hdr-compute-peak=yes
tone-mapping=bt.2446a
tone-mapping-mode=hybrid #hybrid or luma
gamut-mapping-mode=clip
tone-mapping-crosstalk=0.04 #default 0.04. 0-30.

## dithering ##
dither-depth=10
dither=fruit
#error-diffusion= #applicable only when dither=error-diffusion. floyd-steinberg OR atkinson.
#dither-size-fruit=8 #max 8, default 6. results in delayed playback
temporal-dither=yes

#####################
## motion handling ##
#####################
deinterlace=no
#override-display-fps=200 #use in case of jutter
video-sync=display-resample #audio (vrr), display-resample, display-adrop and display-vdrop
interpolation=yes

## interpolation settings ##
tscale=sphinx
tscale-blur=0.6991556596428412
tscale-radius=1.0
tscale-clamp=1.0 #helps prevent temporal ringing(?)
tscale-antiring=1.0


##############################
## additional enhancements ##
##############################
## debanding ##
## more iterations=less range and vice versa ##
deband=yes
deband-iterations=2 #1-16. diminishing returns on debanding strength
deband-threshold=64
deband-range=64 #4-64, default 16
deband-grain=64 #default 48. 0-4096.

## aspect correction ##
#no-keepaspect
#glsl-shader="~~/shaders/nonlinear-stretch.glsl" #note that if this is enabled here, it will be cleared by an auto profile

#####################
## even more stuff ##
#####################

## screenshots ##
screenshot-format=jxl
screenshot-template=mpv%f%P%%[#][0X]n
screenshot-directory="C:\users\unsha\MPVbleedingedge\screenshots"
screenshot-tag-colorspace=yes
screenshot-high-bit-depth=yes
screenshot-jpeg-quality=99
screenshot-jxl-distance=0.1
screenshot-jxl-effort=7 #default 3, 0-9. increases cpu time
screenshot-sw=no

# Audio settings
audio-pitch-correction=yes
volume=65 #startup volume
#audio-stream-silence=yes
audio-resample-filter-size=32 #default 16. range unknown.
audio-resample-phase-shift=12 #10-12. idk what this does.
ad-lavc-downmix=yes #mix surround down to stereo
audio-channels=stereo #force stereo.
audio-normalize-downmix=yes #may be too quiet when downmixing.

# Subtitle settings
no-sub

# OSC settings
osc=no #needed for custom osc, which is currently a fork of the default
script-opts=osc-layout=bottombar,osc-seekbarstyle=bar

# OSD settings
osd-bar-h=2.0
osd-fractions
osd-color='1.0/1.0'
osd-border-color='0.1/0.5'
osd-border-size=1.5
osd-font='Roboto'
osd-font-size=54.5
osd-italic=no
osd-bold=no

# Window settings
fullscreen
keep-open=yes

## Cache Settings ##
cache=yes
cache-secs=9999
vd-queue-max-secs=9999
demuxer-thread=yes
demuxer-readahead-secs=9999
demuxer-max-bytes=2400MiB #limits readahead secs.
demuxer-max-back-bytes=75Mib #rewind cache.
hr-seek=yes
hr-seek-framedrop=yes
cache-pause-initial=yes
cache-pause-wait=2
stream-buffer-size=16KiB #default 128KiB. smaller may be better for streaming. larger may help seek back.
demuxer-lavf-buffersize=32768 #in bytes. lowering may reduce latency. default 32768

## Miscellaneous settings
script-opts=ytdl_hook-ytdl_path="~~/yt-dlp.exe"
script-opts=ytdl_hook-all_formats=yes
ytdl-raw-options=format-sort="hdr,res,vbr,codec"
ytdl-format=bestvideo*[vcodec!*=avc][vbr<21000]+bestaudio / bestvideo*[vbr<21000]+bestaudio
gpu-shader-cache-dir="~~/shadercache"
#reset-on-next-file=all #test
priority=abovenormal

###################
## auto profiles ##
###################
load-auto-profiles=no #"~~/scripts/auto-profiles-mod.lua" handles this instead. leaving built-in auto-profiles.lua causes profiles to be loaded twice, which is bad for shaders.
include="~~/anime_profiles.conf"

[Image]
profile-cond=((width >=1) and p["estimated-vf-fps"]<=1)
fullscreen=no
#glsl-shaders-clr
deband=no
scale=oversample
cscale=oversample

[extension.gif]
loop-file=inf

[extension.jpg]
pause

[extension.png]
pause

#removed tone mapping param in auto profiles. why would i have needed that?

[SDR]
profile-cond=(p["video-params/gamma"]=="bt.1886") #("bt.1886" or "gamma2.2")?
target-peak=auto
target-prim=bt.709
target-trc=auto #srgb may be beneficial
inverse-tone-mapping=no
deband=yes
icc-profile=""

[HDR]
profile-cond=((p["video-params/gamma"]=="pq") or (p["video-params/gamma"]=="hlg"))
target-peak=1207
target-prim=bt.2020
target-trc=pq
deband=no
icc-profile=""

#disabled antiring shader for now as its likely overkill. may reimplement as a full replacement for built in antiring.

[SuperRes]
profile-cond=(width >=3840)
cscale=lanczos
profile=ResClear

[NativeRes]
profile-cond=((width <3840) and (width >=1920))
cscale=mitchell
profile=ResClear
glsl-shaders-append="~~/shaders/KrigBilateral.glsl"
#glsl-shaders-append="~~/shaders/antiring.glsl"

[LowRes]
profile-cond=(width <1920)
cscale=mitchell
profile=ResClear
glsl-shaders-append="~~/shaders/KrigBilateral.glsl"
glsl-shaders-append="~~/shaders/ML_scalers/FSRCNN/FSRCNNX_x2_8-0-4-1.glsl"
glsl-shaders-append="~~/shaders/ML_scalers/FSRCNN/FSRCNNX_x2_8-0-4-1.glsl"
#glsl-shaders-append="~~/shaders/antiring.glsl"

#[Dropped Frames]
#profile-cond=p["frame-drop-count"]>10

#may be worth adding a profile for resolutions such as 480p and below with more intense ML upscaling

#####################
## manual profiles ##
#####################
#don't forget to map manual profiles to hotkeys in input.conf

[HDR->SDR]
target-peak=203
target-prim=bt.709
target-trc=bt.1886
icc-profile="~~/sRGB.icc"

[SDR->HDR]
target-peak=1207
target-prim=bt.2020
target-trc=pq
inverse-tone-mapping=yes
icc-profile=""

[ScaledImage]
#shaders seem to only work on jpegs
fullscreen=yes
deband=no
scale=ewa_lanczos
cscale=lanczos
glsl-shaders-clr
glsl-shader="~~/shaders/ML_scalers/FSRCNN/FSRCNNX_x2_16-0-4-1.glsl"
glsl-shader="~~/shaders/KrigBilateral.glsl"
glsl-shader="~~/shaders/antiring.glsl"

######################
## utility profiles ##
#####################

[ResClear]
#this profile exists as an alternative to glsl-shaders-clr for res affected auto profiles only
glsl-shaders-remove="~~/shaders/KrigBilateral.glsl"
glsl-shaders-remove="~~/shaders/ML_scalers/FSRCNN/FSRCNNX_x2_8-0-4-1.glsl"
glsl-shaders-remove="~~/shaders/ML_scalers/FSRCNN/FSRCNNX_x2_8-0-4-1.glsl"
#glsl-shaders-remove="~~/shaders/antiring.glsl"
profile=AnimeClear

#[TrcClear]
#this profile exists as an alternative to glsl-shaders-clr for trc affected auto profiles only

[benchmark]
audio=no
untimed=yes
video-sync=display-desync
vulkan-swap-mode=immediate
opengl-swapinterval=0
d3d11-sync-interval=0
osd-msg1="FPS: ${estimated-display-fps}"